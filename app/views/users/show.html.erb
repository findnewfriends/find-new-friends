<div class="container justify-content-center mt-5 mb-5">
  <div class="card shadow">
    <!-- START CARD HEADER-->
    <div class="card-header cardHeaderBackground">

      <div class='row p-4'>
        <div class="box_avatar mr-2 col-xl-2 col-sm-8 col-md-6 col-lg-2">
          <%= image_tag('profile_avatar', class: "avatarMatchUser")%>
        </div>
        <div class="bioMatchUser ml-5 mt-4 col-xl-4 col-sm-12 col-md-4 col-lg-3">
          <h1>
            <% if @user.first_name && @user.last_name%>
            <%= @user.first_name  + ' ' + @user.last_name %>
            <% else%>
            No name yet
            <% end%>
          </h1>
          <p>
            <% if @user.birthdate %>
            <%= @user.birthdate %>
            <%else%>
            No date yet
            <% end%>
          </p>
          <p>
            <i class="fas fa-map-marker-alt"></i>
            <% if @user.city%>
            <%= @user.city.name%>
            <% else%>
            No city yet
            <% end %>
          </p>
          <p>
            <% 3.times do %>
            <i class="fas fa-star"></i>
            <% end %>
            <i class="fas fa-star-half-alt"></i>
            <i class="far fa-star"></i>
          </p>

        </div>
        <!-- table info user -->
        <div class="tableInfoUser row col-xl-5 col-sm-12 col-md-12 col-lg-5">
          <table class="table tableColorText">
            <thead>
              <tr>
                <th scope="col">Interests added</th>
                <th scope="col">Last login</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td scope="row"><%= @user.interests.count %></td>
                <td><%= time_ago_in_words(@user.last_sign_in_at) if @user.last_sign_in_at %></td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end table info user-->
        <div class="col-xl-3 col-sm-6 col-md-6 col-lg-3 ml-3">
          <a href="#" class="sendMathRequestButton btn btn-info mt-3 mb-3">Send match request</a>
        </div>
      </div>
    </div>
    <!-- END CARD HEADER-->
    <div class="card-body containerBody text-center">
      <div class='row mt-3 justify-content-center'>
        <div class='col-lg-5 col-xl-5 col-sm-12 col-md-12 interest'>
          <h2 class='card-title text-center my-5'>Interests</h2>
          <% if @user.join_user_interests %>
          <% @user.join_user_interests.each_with_index do |join_user_interests,index|%>
          <h4><%= join_user_interests.interest.name %></h4>
          <h4><%= join_user_interests.intensity %>/4</h4>
          <h4><% bar_width = join_user_interests.intensity.to_f / 5*100 %></h4>
          <div class="progress mb-5">
            <div class="progress-bar progressBarMatchUser" role="progressbar" style="width:<%= bar_width %>%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <% end %>
          <% else %>
          <p>No interest strange...</p>
          <% end %>
        </div>
        <div class='card-text col-lg-6 col-xl-6 col-sm-12 col-md-12 ml-lg-5 ml-xl-5'>

          <h2 class="my-5">Bio</h2>
          <% if @user.description && @user.description.length > 0 %>
            <%= @user.description %>
          <% else %>
            No description yet
          <% end %>

          <h2 class="my-5">References</h2>
          <% if @user.references && @user.references.length > 0 %>
            <% @user.references.each do |reference|%>
            <%= reference.content %><br> by
            <%= link_to "#{reference.author.first_name} #{reference.author.last_name}", user_path(reference.author.id), class: '' %>
            <br><%= time_ago_in_words(reference.created_at) %>
            <% end %>
          <% else %>
            No References yet
          <% end %>


          <% if @user == current_user %>

            <h2 class="my-5">Contact request received</h2>
            <% if @match_requests_received && @match_requests_received.any? %>
              <% @match_requests_received.each do |request_received|%>
              <%= link_to "#{request_received.user.first_name} #{request_received.user.last_name}", user_path(request_received.user.id), class: '' %>
              <br><a href="#" class="text-info">Accept request</a><br><br>
              <% end %>
            <% else %>
              No match requests received
            <% end %>

            <h2 class="my-5">Contact request sent</h2>
              <% if @match_requests_sent && @match_requests_sent.any? %>
              <% @match_requests_sent.each do |request_sent|%>
              <%= link_to "#{request_sent.matched_user.first_name} #{request_sent.matched_user.last_name}", user_path(request_sent.matched_user.id), class: '' %>
              <br><a href="#" class="text-info">Cancel request</a><br><br>
              <% end %>
            <% else %>
              No match requests sent
            <% end %>

          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
